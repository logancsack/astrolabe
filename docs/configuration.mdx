---
title: "Configuration"
description: "Configure Astrolabe routing, safety behavior, and cost guardrails."
---

Astrolabe is configured entirely through environment variables.

After changing settings, restart the server.

Use `GET /health` to confirm active normalized runtime values (`routing_profile`, `cost_efficiency_mode`, and related flags).

## Configuration mental model

Astrolabe configuration operates in three layers:

1. **Policy intent**: `ASTROLABE_ROUTING_PROFILE` adjusts baseline aggressiveness.
2. **Cost controls**: `ASTROLABE_COST_EFFICIENCY_MODE` and premium-route controls shape spend behavior.
3. **Safety controls**: high-stakes detection and confirmation requirements control sensitive execution.

Overrides like `ASTROLABE_FORCE_MODEL` bypass these layers for deterministic testing or emergency pinning.

## Mode quick reference

| Setting | Values | Default | Controls |
| --- | --- | --- | --- |
| `ASTROLABE_ROUTING_PROFILE` | `budget`, `balanced`, `quality` | `budget` | Baseline policy aggressiveness before cost guardrails |
| `ASTROLABE_COST_EFFICIENCY_MODE` | `strict`, `balanced`, `off` | `strict` | How strongly guardrails push toward cheaper routes |
| `ASTROLABE_HIGH_STAKES_CONFIRM_MODE` | `prompt`, `strict`, `off` | `prompt` | Confirmation behavior for high-stakes requests |

`strict` appears in two separate contexts:

- `ASTROLABE_COST_EFFICIENCY_MODE=strict`: cost strictness
- `ASTROLABE_HIGH_STAKES_CONFIRM_MODE=strict`: confirmation strictness

## Recommended presets

### Maximum savings (default release posture)

```bash
ASTROLABE_ROUTING_PROFILE=budget
ASTROLABE_COST_EFFICIENCY_MODE=strict
ASTROLABE_ALLOW_DIRECT_PREMIUM_MODELS=false
ASTROLABE_ENABLE_SAFETY_GATE=true
ASTROLABE_HIGH_STAKES_CONFIRM_MODE=prompt
```

### Balanced capability

```bash
ASTROLABE_ROUTING_PROFILE=balanced
ASTROLABE_COST_EFFICIENCY_MODE=balanced
ASTROLABE_ALLOW_DIRECT_PREMIUM_MODELS=false
ASTROLABE_ENABLE_SAFETY_GATE=true
ASTROLABE_HIGH_STAKES_CONFIRM_MODE=prompt
```

### High caution on sensitive actions

```bash
ASTROLABE_ROUTING_PROFILE=budget
ASTROLABE_COST_EFFICIENCY_MODE=strict
ASTROLABE_ENABLE_SAFETY_GATE=true
ASTROLABE_HIGH_STAKES_CONFIRM_MODE=strict
ASTROLABE_HIGH_STAKES_CONFIRM_TOKEN=confirm
```

## Practical behavior examples

- If requests feel too expensive: keep `routing_profile=budget`, `cost_efficiency_mode=strict`, and block direct premium routes.
- If answers are often too shallow: move to `routing_profile=balanced` or `quality`.
- If your workflow includes approvals/transfers/legal actions: keep safety gate enabled and use strict confirmation mode.
- If you need deterministic upstream behavior for diagnostics: set `ASTROLABE_FORCE_MODEL`.

## Complete environment variable reference

| Variable | Required | Default | Allowed values | Effect |
| --- | --- | --- | --- | --- |
| `OPENROUTER_API_KEY` | Yes | none | OpenRouter key string | Required to send upstream requests |
| `ASTROLABE_API_KEY` | No (recommended) | empty | any string | Inbound auth key for Astrolabe endpoint |
| `PORT` | No | `3000` | integer | HTTP listen port |
| `OPENROUTER_SITE_URL` | No | empty | URL | Sent as `HTTP-Referer` to OpenRouter |
| `OPENROUTER_APP_NAME` | No | empty | string | Sent as `X-Title` to OpenRouter |
| `ASTROLABE_ROUTING_PROFILE` | No | `budget` | `budget`, `balanced`, `quality` | Policy complexity adjustment before guardrails |
| `ASTROLABE_COST_EFFICIENCY_MODE` | No | `strict` | `strict`, `balanced`, `off` | Cost guardrail strength |
| `ASTROLABE_ALLOW_DIRECT_PREMIUM_MODELS` | No | `false` | `true`, `false` | Allows/disallows direct Sonnet/Opus routing for non-high-stakes |
| `ASTROLABE_ENABLE_SAFETY_GATE` | No | `true` | `true`, `false` | Enables pre-classification high-stakes detection |
| `ASTROLABE_HIGH_STAKES_CONFIRM_MODE` | No | `prompt` | `prompt`, `strict`, `off` | High-stakes confirmation policy |
| `ASTROLABE_HIGH_STAKES_CONFIRM_TOKEN` | No | `confirm` | string | Required token when confirm mode is `strict` |
| `ASTROLABE_ALLOW_HIGH_STAKES_BUDGET_FLOOR` | No | `false` | `true`, `false` | Allows Sonnet floor for high-stakes in budget profile |
| `ASTROLABE_CLASSIFIER_MODEL_KEY` | No | `nano` | `nano`, `grok`, `sonnet`, `opus`, `dsCoder`, `gemFlash`, `gem31Pro`, `kimiK25`, `glm5` | Primary classifier model key |
| `ASTROLABE_SELF_CHECK_MODEL_KEY` | No | `nano` | `nano`, `grok`, `sonnet`, `opus`, `dsCoder`, `gemFlash`, `gem31Pro`, `kimiK25`, `glm5` | Primary self-check model key |
| `ASTROLABE_CONTEXT_MESSAGES` | No | `8` | integer (clamped `3-20`) | Max recent messages included in classifier context |
| `ASTROLABE_CONTEXT_CHARS` | No | `2500` | integer (clamped `600-12000`) | Max characters included in classifier context |
| `ASTROLABE_FORCE_MODEL` | No | empty | full model id string | Bypasses routing/classifier/self-check escalation and forces one upstream model |

## Validation and fallback behavior

- Invalid `ASTROLABE_ROUTING_PROFILE` values fall back to `budget`.
- Invalid `ASTROLABE_COST_EFFICIENCY_MODE` values fall back to `strict`.
- Invalid `ASTROLABE_HIGH_STAKES_CONFIRM_MODE` values fall back to `prompt`.
- Unknown classifier/self-check model keys are skipped and Astrolabe falls back to built-in candidate chains.
- `ASTROLABE_CONTEXT_MESSAGES` and `ASTROLABE_CONTEXT_CHARS` are clamped to safe ranges.

## Operational verification checklist

After configuration changes:

1. Restart Astrolabe.
2. Call `GET /health` and verify normalized mode values.
3. Send one non-stream request and inspect `x-astrolabe-*` headers.
4. Confirm routed model behavior in logs (`chosen_model`, `final_model`, `route`).

## Pricing notes

Cost logs use the `pricePer1M` table in `server.js` keyed by full model ID.

When provider pricing changes, update this table so `est_usd` remains accurate.
